#!/bin/sh

CONTAINER="zendash-php-1"

if ! docker ps | grep -q "$CONTAINER"; then
    echo "‚ö†Ô∏è  Erreur : Le conteneur $CONTAINER n'est pas lanc√©."
    echo "Lance 'docker compose up -d' avant de push."
    exit 1
fi

echo "üöÄ Lancement de la QA / tests..."

docker exec -e APP_ENV=test -e APP_DEBUG=1 "$CONTAINER" composer qa

# Capture the exit code
QA_EXIT_CODE=$?

if [ $QA_EXIT_CODE -ne 0 ]; then
    echo "‚ùå √âchec de la QA. Corrige les erreurs avant de push."
    exit 1
fi

echo "‚úÖ QA valid√©e. Push en cours..."
exit 0
